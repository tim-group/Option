releaseVersion = '1.0'

apply plugin: 'eclipse'
apply plugin: 'idea'
apply plugin: 'java'
apply plugin: 'maven'

group = "com.timgroup"
version = version(project)

dependencies {
    compile     group: 'com.googlecode.lambdaj',        name: 'lambdaj',                version: '2.3.1'

    testCompile     group: "junit",         name: 'junit-dep',           version: "4.8.2"
    testCompile     group: 'org.hamcrest',  name: 'hamcrest-all',        version: '1.1'
    testCompile    (group: 'org.mockito',   name: 'mockito-core',        version: '1.8.5') {
              exclude module: 'hamcrest-core'
    }
}

repositories {
    mavenCentral()
    mavenRepo name: 'lambdaj', urls: 'http://lambdaj.googlecode.com/svn/repo/releases'
}

task sourcesJar(type: Jar, dependsOn:classes) {
     classifier = 'sources'
     from sourceSets.main.allSource
}

artifacts {
     archives sourcesJar
}

task wrapper(type: Wrapper) {
    gradleVersion = '0.9.2'
}

def version(Project project) {
    def releaseVersion = '0';
    if (project.hasProperty('releaseVersion') && !project.releaseVersion.isEmpty()) {
        releaseVersion = project.releaseVersion
    }

    String projectVersion
    def ciBuildNumber = System.getenv("BUILD_NUMBER")
    if (ciBuildNumber == null || ciBuildNumber.isEmpty()) {
        projectVersion = releaseVersion + '.0.' + (new Date()).format("yyyyMMdd-HHmmss") + '-dev'
    } else {
        projectVersion = releaseVersion + '.' + ciBuildNumber
    }
    return projectVersion
}